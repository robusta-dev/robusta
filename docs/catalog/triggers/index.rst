Triggers
==========

Triggers define when a playbook runs.

Configuring triggers
^^^^^^^^^^^^^^^^^^^^^^^^^^^
In the yaml, ``triggers`` is an array, but currently it must contain exactly one entry.

Most triggers support filters to further restrict when the playbook runs. Lets run a playbook only when a deployment
named "MyApp" updates:

.. code-block:: yaml
    :emphasize-lines: 3-4

    customPlaybooks:
      - triggers:
          - on_deployment_update:
              name_prefix: MyApp
        actions:
          - resource_babysitter:
              fields_to_monitor: ["status.conditions"]
        sinks:
          - "slack sink"

These filters are almost always optional. When left out, the filter matches everything.

Common filters
^^^^^^^^^^^^^^^^^

1. All Kubernetes triggers support ``name_prefix`` and ``namespace_prefix``
2. `on_prometheus_alert` supports a number of filters like `alert_name`

See each trigger's documentation for additional filters

Trigger hierarchy
^^^^^^^^^^^^^^^^^^^^^^^^^

All of the triggers in Robusta form a hierarchy with BaseTrigger at the top and other triggers inheriting from it.

If a playbook supports a specific trigger, it also supports all descendants of that trigger. For example, the trigger
``on_kubernetes_any_resource_create`` has a child trigger ``on_deployment_create``. So that latter may  be used wherever
the former is expected.

.. inheritance-diagram:: robusta.api.DeploymentEvent robusta.api.PodEvent robusta.api.PodChangeEvent robusta.api.NodeEvent
    :parts: 1

.. inheritance-diagram:: robusta.integrations.kubernetes.autogenerated.events
    :parts: 1

.. inheritance-diagram:: robusta.integrations.kubernetes.autogenerated.triggers
    :parts: 1

.. autoclasstree:: robusta.integrations.kubernetes.autogenerated.events


Manual triggers
^^^^^^^^^^^^^^^^^^^
The following triggers can be sent manually which allows running playbook actions on demand: / any trigger with a *  in the above hierarchy supports manual triggers

TODO

For manual triggering, you do **not** need to be defined anything ``values.yaml`` in advance.

See :ref:`Manual Triggers` for instructions.

Builtin triggers
^^^^^^^^^^^^^^^^^^

.. toctree::
   :maxdepth: 1

   prometheus
   kubernetes
   elasticsearch
   scheduled
   webhook
